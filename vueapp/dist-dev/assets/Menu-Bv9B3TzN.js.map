{"version":3,"file":"Menu-Bv9B3TzN.js","sources":["../../src/views/Authorization/Menu/Menu.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { reactive, ref, unref } from 'vue'\nimport { getMenuListApi } from '@/api/menu'\nimport { useTable } from '@/hooks/web/useTable'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { Table, TableColumn } from '@/components/Table'\nimport { ElTag } from 'element-plus'\nimport { Icon } from '@/components/Icon'\nimport { Search } from '@/components/Search'\nimport { FormSchema } from '@/components/Form'\nimport { ContentWrap } from '@/components/ContentWrap'\nimport Write from './components/Write.vue'\nimport Detail from './components/Detail.vue'\nimport { Dialog } from '@/components/Dialog'\nimport { BaseButton } from '@/components/Button'\n\nconst { t } = useI18n()\n\nconst { tableRegister, tableState, tableMethods } = useTable({\n  fetchDataApi: async () => {\n    const res = await getMenuListApi()\n    return {\n      list: res.data.list || []\n    }\n  }\n})\n\nconst { dataList, loading } = tableState\nconst { getList } = tableMethods\n\nconst tableColumns = reactive<TableColumn[]>([\n  {\n    field: 'index',\n    label: t('userDemo.index'),\n    type: 'index'\n  },\n  {\n    field: 'meta.title',\n    label: t('menu.menuName'),\n    slots: {\n      default: (data: any) => {\n        const title = data.row.meta.title\n        return <>{title}</>\n      }\n    }\n  },\n  {\n    field: 'meta.icon',\n    label: t('menu.icon'),\n    slots: {\n      default: (data: any) => {\n        const icon = data.row.meta.icon\n        if (icon) {\n          return (\n            <>\n              <Icon icon={icon} />\n            </>\n          )\n        } else {\n          return null\n        }\n      }\n    }\n  },\n  // {\n  //   field: 'meta.permission',\n  //   label: t('menu.permission'),\n  //   slots: {\n  //     default: (data: any) => {\n  //       const permission = data.row.meta.permission\n  //       return permission ? <>{permission.join(', ')}</> : null\n  //     }\n  //   }\n  // },\n  {\n    field: 'component',\n    label: t('menu.component'),\n    slots: {\n      default: (data: any) => {\n        const component = data.row.component\n        return <>{component === '#' ? '顶级目录' : component === '##' ? '子目录' : component}</>\n      }\n    }\n  },\n  {\n    field: 'path',\n    label: t('menu.path')\n  },\n  {\n    field: 'status',\n    label: t('menu.status'),\n    slots: {\n      default: (data: any) => {\n        return (\n          <>\n            <ElTag type={data.row.status === 0 ? 'danger' : 'success'}>\n              {data.row.status === 1 ? t('userDemo.enable') : t('userDemo.disable')}\n            </ElTag>\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'action',\n    label: t('userDemo.action'),\n    width: 240,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <BaseButton type=\"primary\" onClick={() => action(row, 'edit')}>\n              {t('exampleDemo.edit')}\n            </BaseButton>\n            <BaseButton type=\"success\" onClick={() => action(row, 'detail')}>\n              {t('exampleDemo.detail')}\n            </BaseButton>\n            <BaseButton type=\"danger\">{t('exampleDemo.del')}</BaseButton>\n          </>\n        )\n      }\n    }\n  }\n])\n\nconst searchSchema = reactive<FormSchema[]>([\n  {\n    field: 'meta.title',\n    label: t('menu.menuName'),\n    component: 'Input'\n  }\n])\n\nconst searchParams = ref({})\nconst setSearchParams = (data: any) => {\n  searchParams.value = data\n  getList()\n}\n\nconst dialogVisible = ref(false)\nconst dialogTitle = ref('')\n\nconst currentRow = ref()\nconst actionType = ref('')\n\nconst writeRef = ref<ComponentRef<typeof Write>>()\n\nconst saveLoading = ref(false)\n\nconst action = (row: any, type: string) => {\n  dialogTitle.value = t(type === 'edit' ? 'exampleDemo.edit' : 'exampleDemo.detail')\n  actionType.value = type\n  currentRow.value = row\n  dialogVisible.value = true\n}\n\nconst AddAction = () => {\n  dialogTitle.value = t('exampleDemo.add')\n  currentRow.value = undefined\n  dialogVisible.value = true\n  actionType.value = ''\n}\n\nconst save = async () => {\n  const write = unref(writeRef)\n  const formData = await write?.submit()\n  console.log(formData)\n  if (formData) {\n    saveLoading.value = true\n    setTimeout(() => {\n      saveLoading.value = false\n      dialogVisible.value = false\n    }, 1000)\n  }\n}\n</script>\n\n<template>\n  <ContentWrap>\n    <Search :schema=\"searchSchema\" @reset=\"setSearchParams\" @search=\"setSearchParams\" />\n    <div class=\"mb-10px\">\n      <BaseButton type=\"primary\" @click=\"AddAction\">{{ t('exampleDemo.add') }}</BaseButton>\n    </div>\n    <Table\n      :columns=\"tableColumns\"\n      default-expand-all\n      node-key=\"id\"\n      :data=\"dataList\"\n      :loading=\"loading\"\n      @register=\"tableRegister\"\n    />\n  </ContentWrap>\n\n  <Dialog v-model=\"dialogVisible\" :title=\"dialogTitle\">\n    <Write v-if=\"actionType !== 'detail'\" ref=\"writeRef\" :current-row=\"currentRow\" />\n\n    <Detail v-if=\"actionType === 'detail'\" :current-row=\"currentRow\" />\n\n    <template #footer>\n      <BaseButton\n        v-if=\"actionType !== 'detail'\"\n        type=\"primary\"\n        :loading=\"saveLoading\"\n        @click=\"save\"\n      >\n        {{ t('exampleDemo.save') }}\n      </BaseButton>\n      <BaseButton @click=\"dialogVisible = false\">{{ t('dialogDemo.close') }}</BaseButton>\n    </template>\n  </Dialog>\n</template>\n"],"names":["_isSlot","s","Object","prototype","toString","call","_isVNode","t","useI18n","tableRegister","tableState","tableMethods","useTable","fetchDataApi","__async","list","getMenuListApi","data","dataList","loading","getList","tableColumns","reactive","field","label","type","slots","default","title","row","meta","_createVNode2","_Fragment2","icon","Icon","component","ElTag","status","width","_slot","_slot2","_slot3","BaseButton","onClick","action","searchSchema","searchParams","ref","setSearchParams","value","dialogVisible","dialogTitle","currentRow","actionType","writeRef","saveLoading","AddAction","undefined","save","write","unref","formData","submit","console","log","setTimeout"],"mappings":"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"}
{"version":3,"file":"EditPassword.vue_vue_type_script_setup_true_lang-DwHcmhRW.js","sources":["../../src/views/Personal/PersonalCenter/components/EditPassword.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { Form, FormSchema } from '@/components/Form'\nimport { useForm } from '@/hooks/web/useForm'\nimport { reactive, ref } from 'vue'\nimport { useValidator } from '@/hooks/web/useValidator'\nimport { ElMessage, ElMessageBox, ElDivider } from 'element-plus'\n\nconst { required } = useValidator()\n\nconst formSchema = reactive<FormSchema[]>([\n  {\n    field: 'password',\n    label: '旧密码',\n    component: 'InputPassword',\n    colProps: {\n      span: 24\n    }\n  },\n  {\n    field: 'newPassword',\n    label: '新密码',\n    component: 'InputPassword',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      strength: true\n    }\n  },\n  {\n    field: 'newPassword2',\n    label: '确认新密码',\n    component: 'InputPassword',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      strength: true\n    }\n  }\n])\n\nconst rules = reactive({\n  password: [required()],\n  newPassword: [\n    required(),\n    {\n      asyncValidator: async (_, val, callback) => {\n        const formData = await getFormData()\n        const { newPassword2 } = formData\n        if (val !== newPassword2) {\n          callback(new Error('新密码与确认新密码不一致'))\n        } else {\n          callback()\n        }\n      }\n    }\n  ],\n  newPassword2: [\n    required(),\n    {\n      asyncValidator: async (_, val, callback) => {\n        const formData = await getFormData()\n        const { newPassword } = formData\n        if (val !== newPassword) {\n          callback(new Error('确认新密码与新密码不一致'))\n        } else {\n          callback()\n        }\n      }\n    }\n  ]\n})\n\nconst { formRegister, formMethods } = useForm()\nconst { getFormData, getElFormExpose } = formMethods\n\nconst saveLoading = ref(false)\nconst save = async () => {\n  const elForm = await getElFormExpose()\n  const valid = await elForm?.validate().catch((err) => {\n    console.log(err)\n  })\n  if (valid) {\n    ElMessageBox.confirm('是否确认修改?', '提示', {\n      confirmButtonText: '确认',\n      cancelButtonText: '取消',\n      type: 'warning'\n    })\n      .then(async () => {\n        try {\n          saveLoading.value = true\n          // 这里可以调用修改密码的接口\n          ElMessage.success('修改成功')\n        } catch (error) {\n          console.log(error)\n        } finally {\n          saveLoading.value = false\n        }\n      })\n      .catch(() => {})\n  }\n}\n</script>\n\n<template>\n  <Form :rules=\"rules\" @register=\"formRegister\" :schema=\"formSchema\" />\n  <ElDivider />\n  <BaseButton type=\"primary\" @click=\"save\">确认修改</BaseButton>\n</template>\n"],"names":["required","useValidator","formSchema","reactive","rules","_","val","callback","__async","formData","getFormData","newPassword2","newPassword","formRegister","formMethods","useForm","getElFormExpose","saveLoading","ref","save","elForm","err","ElMessageBox","ElMessage","error"],"mappings":"smBAOM,KAAA,CAAE,SAAAA,CAAS,EAAIC,EAAa,EAE5BC,EAAaC,EAAuB,CACxC,CACE,MAAO,WACP,MAAO,MACP,UAAW,gBACX,SAAU,CACR,KAAM,EAAA,CAEV,EACA,CACE,MAAO,cACP,MAAO,MACP,UAAW,gBACX,SAAU,CACR,KAAM,EACR,EACA,eAAgB,CACd,SAAU,EAAA,CAEd,EACA,CACE,MAAO,eACP,MAAO,QACP,UAAW,gBACX,SAAU,CACR,KAAM,EACR,EACA,eAAgB,CACd,SAAU,EAAA,CACZ,CACF,CACD,EAEKC,EAAQD,EAAS,CACrB,SAAU,CAACH,GAAU,EACrB,YAAa,CACXA,EAAS,EACT,CACE,eAAgB,CAAOK,EAAGC,EAAKC,IAAaC,EAAA,sBACpC,MAAAC,EAAW,MAAMC,EAAY,EAC7B,CAAE,aAAAC,GAAiBF,EACrBH,IAAQK,EACDJ,EAAA,IAAI,MAAM,cAAc,CAAC,EAEzBA,EAAA,CACX,EACF,CAEJ,EACA,aAAc,CACZP,EAAS,EACT,CACE,eAAgB,CAAOK,EAAGC,EAAKC,IAAaC,EAAA,sBACpC,MAAAC,EAAW,MAAMC,EAAY,EAC7B,CAAE,YAAAE,GAAgBH,EACpBH,IAAQM,EACDL,EAAA,IAAI,MAAM,cAAc,CAAC,EAEzBA,EAAA,CACX,EACF,CACF,CACF,CACD,EAEK,CAAE,aAAAM,EAAc,YAAAC,CAAY,EAAIC,EAAQ,EACxC,CAAE,YAAAL,EAAa,gBAAAM,CAAA,EAAoBF,EAEnCG,EAAcC,EAAI,EAAK,EACvBC,EAAO,IAAYX,EAAA,sBACjB,MAAAY,EAAS,MAAMJ,EAAgB,GACvB,MAAMI,GAAA,YAAAA,EAAQ,WAAW,MAAOC,GAAQ,CACpD,QAAQ,IAAIA,CAAG,CAAA,KAGFC,EAAA,QAAQ,UAAW,KAAM,CACpC,kBAAmB,KACnB,iBAAkB,KAClB,KAAM,SAAA,CACP,EACE,KAAK,IAAYd,EAAA,sBACZ,GAAA,CACFS,EAAY,MAAQ,GAEpBM,EAAU,QAAQ,MAAM,QACjBC,EAAO,CACd,QAAQ,IAAIA,CAAK,CAAA,QACjB,CACAP,EAAY,MAAQ,EAAA,CACtB,EACD,EACA,MAAM,IAAM,CAAA,CAAE,CAErB"}
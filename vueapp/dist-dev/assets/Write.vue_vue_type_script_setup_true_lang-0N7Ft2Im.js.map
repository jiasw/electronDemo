{"version":3,"file":"Write.vue_vue_type_script_setup_true_lang-0N7Ft2Im.js","sources":["../../src/views/Authorization/Menu/components/Write.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { Form, FormSchema } from '@/components/Form'\nimport { useForm } from '@/hooks/web/useForm'\nimport { PropType, reactive, watch, ref, unref } from 'vue'\nimport { useValidator } from '@/hooks/web/useValidator'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { getMenuListApi } from '@/api/menu'\nimport { ElButton, ElInput, ElPopconfirm, ElTable, ElTableColumn, ElTag } from 'element-plus'\nimport AddButtonPermission from './AddButtonPermission.vue'\nimport { BaseButton } from '@/components/Button'\nimport { cloneDeep } from 'lodash-es'\n\nconst { t } = useI18n()\n\nconst { required } = useValidator()\n\nconst props = defineProps({\n  currentRow: {\n    type: Object as PropType<any>,\n    default: () => null\n  }\n})\n\nconst handleClose = async (tag: any) => {\n  const formData = await getFormData()\n  // 删除对应的权限\n  setValues({\n    permissionList: formData?.permissionList?.filter((v: any) => v.value !== tag.value)\n  })\n}\n\nconst handleEdit = async (row: any) => {\n  // 深拷贝当前行数据到编辑行\n  permissionEditingRow.value = { ...row }\n}\n\nconst handleSave = async () => {\n  const formData = await getFormData()\n  const index = formData?.permissionList?.findIndex((x) => x.id === permissionEditingRow.value.id)\n  if (index !== -1) {\n    formData.permissionList[index] = { ...permissionEditingRow.value }\n    permissionEditingRow.value = null // 重置编辑状态\n  }\n}\n\nconst showDrawer = ref(false)\n// 存储正在编辑的行的数据\nconst permissionEditingRow = ref<any>(null)\n\nconst formSchema = reactive<FormSchema[]>([\n  {\n    field: 'type',\n    label: '菜单类型',\n    component: 'RadioButton',\n    value: 0,\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      options: [\n        {\n          label: '目录',\n          value: 0\n        },\n        {\n          label: '菜单',\n          value: 1\n        }\n      ],\n      on: {\n        change: async (val: number) => {\n          const formData = await getFormData()\n          if (val === 1) {\n            setSchema([\n              {\n                field: 'component',\n                path: 'componentProps.disabled',\n                value: false\n              }\n            ])\n            setValues({\n              component: unref(cacheComponent)\n            })\n          } else {\n            setSchema([\n              {\n                field: 'component',\n                path: 'componentProps.disabled',\n                value: true\n              }\n            ])\n\n            if (formData.parentId === void 0) {\n              setValues({\n                component: '#'\n              })\n            } else {\n              setValues({\n                component: '##'\n              })\n            }\n          }\n        }\n      }\n    }\n  },\n  {\n    field: 'parentId',\n    label: '父级菜单',\n    component: 'TreeSelect',\n    componentProps: {\n      nodeKey: 'id',\n      props: {\n        label: 'title',\n        value: 'id',\n        children: 'children'\n      },\n      highlightCurrent: true,\n      expandOnClickNode: false,\n      checkStrictly: true,\n      checkOnClickNode: true,\n      clearable: true,\n      on: {\n        change: async (val: number) => {\n          const formData = await getFormData()\n          if (val && formData.type === 0) {\n            setValues({\n              component: '##'\n            })\n          } else if (!val && formData.type === 0) {\n            setValues({\n              component: '#'\n            })\n          } else if (formData.type === 1) {\n            setValues({\n              component: unref(cacheComponent) ?? ''\n            })\n          }\n        }\n      }\n    },\n    optionApi: async () => {\n      const res = await getMenuListApi()\n      return res.data.list || []\n    }\n  },\n  {\n    field: 'meta.title',\n    label: t('menu.menuName'),\n    component: 'Input'\n  },\n  {\n    field: 'component',\n    label: '组件',\n    component: 'Input',\n    value: '#',\n    componentProps: {\n      disabled: true,\n      placeholder: '#为顶级目录，##为子目录',\n      on: {\n        change: (val: string) => {\n          cacheComponent.value = val\n        }\n      }\n    }\n  },\n  {\n    field: 'name',\n    label: t('menu.name'),\n    component: 'Input'\n  },\n  {\n    field: 'meta.icon',\n    label: t('menu.icon'),\n    component: 'Input'\n  },\n  {\n    field: 'path',\n    label: t('menu.path'),\n    component: 'Input'\n  },\n  {\n    field: 'meta.activeMenu',\n    label: t('menu.activeMenu'),\n    component: 'Input'\n  },\n  {\n    field: 'status',\n    label: t('menu.status'),\n    component: 'Select',\n    componentProps: {\n      options: [\n        {\n          label: t('userDemo.disable'),\n          value: 0\n        },\n        {\n          label: t('userDemo.enable'),\n          value: 1\n        }\n      ]\n    }\n  },\n  {\n    field: 'permissionList',\n    label: t('menu.permission'),\n    component: 'CheckboxGroup',\n    colProps: {\n      span: 24\n    },\n    formItemProps: {\n      slots: {\n        default: (data: any) => (\n          <>\n            <BaseButton\n              class=\"m-t-5px\"\n              type=\"primary\"\n              size=\"small\"\n              onClick={() => (showDrawer.value = true)}\n            >\n              添加权限\n            </BaseButton>\n            <ElTable data={data?.permissionList}>\n              <ElTableColumn type=\"index\" prop=\"id\" />\n              <ElTableColumn\n                prop=\"value\"\n                label=\"Value\"\n                v-slots={{\n                  default: ({ row }: any) =>\n                    permissionEditingRow.value && permissionEditingRow.value.id === row.id ? (\n                      <ElInput v-model={permissionEditingRow.value.value} size=\"small\" />\n                    ) : (\n                      <span>{row.value}</span>\n                    )\n                }}\n              />\n              <ElTableColumn\n                prop=\"label\"\n                label=\"Label\"\n                v-slots={{\n                  default: ({ row }: any) =>\n                    permissionEditingRow.value && permissionEditingRow.value.id === row.id ? (\n                      <ElInput v-model={permissionEditingRow.value.label} size=\"small\" />\n                    ) : (\n                      <ElTag class=\"mr-1\" key={row.value}>\n                        {row.label}\n                      </ElTag>\n                    )\n                }}\n              />\n              <ElTableColumn\n                label=\"Operations\"\n                width=\"180\"\n                v-slots={{\n                  default: ({ row }: any) =>\n                    permissionEditingRow.value && permissionEditingRow.value.id === row.id ? (\n                      <ElButton size=\"small\" type=\"primary\" onClick={handleSave}>\n                        确定\n                      </ElButton>\n                    ) : (\n                      <>\n                        <ElButton size=\"small\" type=\"primary\" onClick={() => handleEdit(row)}>\n                          编辑\n                        </ElButton>\n                        <ElPopconfirm\n                          title=\"Are you sure to delete this?\"\n                          onConfirm={() => handleClose(row)}\n                        >\n                          {{\n                            reference: () => (\n                              <ElButton size=\"small\" type=\"danger\">\n                                删除\n                              </ElButton>\n                            )\n                          }}\n                        </ElPopconfirm>\n                      </>\n                    )\n                }}\n              />\n            </ElTable>\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'meta.hidden',\n    label: t('menu.hidden'),\n    component: 'Switch'\n  },\n  {\n    field: 'meta.alwaysShow',\n    label: t('menu.alwaysShow'),\n    component: 'Switch'\n  },\n  {\n    field: 'meta.noCache',\n    label: t('menu.noCache'),\n    component: 'Switch'\n  },\n  {\n    field: 'meta.breadcrumb',\n    label: t('menu.breadcrumb'),\n    component: 'Switch'\n  },\n  {\n    field: 'meta.affix',\n    label: t('menu.affix'),\n    component: 'Switch'\n  },\n  {\n    field: 'meta.noTagsView',\n    label: t('menu.noTagsView'),\n    component: 'Switch'\n  },\n  {\n    field: 'meta.canTo',\n    label: t('menu.canTo'),\n    component: 'Switch'\n  }\n])\n\nconst rules = reactive({\n  component: [required()],\n  path: [required()],\n  'meta.title': [required()]\n})\n\nconst { formRegister, formMethods } = useForm()\nconst { setValues, getFormData, getElFormExpose, setSchema } = formMethods\n\nconst submit = async () => {\n  const elForm = await getElFormExpose()\n  const valid = await elForm?.validate().catch((err) => {\n    console.log(err)\n  })\n  if (valid) {\n    const formData = await getFormData()\n    return formData\n  }\n}\n\nconst cacheComponent = ref('')\n\nwatch(\n  () => props.currentRow,\n  (value) => {\n    if (!value) return\n    const currentRow = cloneDeep(value)\n    cacheComponent.value = currentRow.type === 1 ? currentRow.component : ''\n    if (currentRow.parentId === 0) {\n      setSchema([\n        {\n          field: 'component',\n          path: 'componentProps.disabled',\n          value: true\n        }\n      ])\n    } else {\n      setSchema([\n        {\n          field: 'component',\n          path: 'componentProps.disabled',\n          value: false\n        }\n      ])\n    }\n    if (currentRow.type === 1) {\n      setSchema([\n        {\n          field: 'component',\n          path: 'componentProps.disabled',\n          value: false\n        }\n      ])\n    } else {\n      setSchema([\n        {\n          field: 'component',\n          path: 'componentProps.disabled',\n          value: true\n        }\n      ])\n    }\n    setValues(currentRow)\n  },\n  {\n    deep: true,\n    immediate: true\n  }\n)\n\ndefineExpose({\n  submit\n})\n\nconst confirm = async (data: any) => {\n  const formData = await getFormData()\n  setValues({\n    permissionList: [...(formData?.permissionList || []), data]\n  })\n}\n</script>\n\n<template>\n  <Form :rules=\"rules\" @register=\"formRegister\" :schema=\"formSchema\" />\n  <AddButtonPermission v-model=\"showDrawer\" @confirm=\"confirm\" />\n</template>\n"],"names":["t","useI18n","required","useValidator","props","__props","handleClose","tag","__async","formData","getFormData","setValues","permissionList","filter","v","value","handleEdit","row","permissionEditingRow","__spreadValues","handleSave","index","findIndex","x","id","showDrawer","ref","formSchema","reactive","field","label","component","colProps","span","componentProps","options","on","change","val","setSchema","path","unref","cacheComponent","parentId","nodeKey","children","highlightCurrent","expandOnClickNode","checkStrictly","checkOnClickNode","clearable","type","optionApi","getMenuListApi","data","list","disabled","placeholder","formItemProps","slots","default","_createVNode2","_Fragment2","BaseButton","onClick","_createTextVNode","ElTable","ElTableColumn","ElInput","$event","ElTag","ElButton","ElPopconfirm","onConfirm","reference","rules","formRegister","formMethods","useForm","getElFormExpose","submit","elForm","validate","catch","err","console","log","watch","currentRow","cloneDeep","deep","immediate","__expose","confirm"],"mappings":"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"}
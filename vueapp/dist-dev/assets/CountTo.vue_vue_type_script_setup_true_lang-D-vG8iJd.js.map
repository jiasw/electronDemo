{"version":3,"file":"CountTo.vue_vue_type_script_setup_true_lang-D-vG8iJd.js","sources":["../../src/components/CountTo/src/CountTo.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { reactive, computed, watch, onMounted, unref, toRef, PropType } from 'vue'\nimport { isNumber } from '@/utils/is'\nimport { propTypes } from '@/utils/propTypes'\nimport { useDesign } from '@/hooks/web/useDesign'\n\nconst { getPrefixCls } = useDesign()\n\nconst prefixCls = getPrefixCls('count-to')\n\nconst props = defineProps({\n  startVal: propTypes.number.def(0),\n  endVal: propTypes.number.def(2021),\n  duration: propTypes.number.def(3000),\n  autoplay: propTypes.bool.def(true),\n  decimals: propTypes.number.validate((value: number) => value >= 0).def(0),\n  decimal: propTypes.string.def('.'),\n  separator: propTypes.string.def(','),\n  prefix: propTypes.string.def(''),\n  suffix: propTypes.string.def(''),\n  useEasing: propTypes.bool.def(true),\n  easingFn: {\n    type: Function as PropType<(t: number, b: number, c: number, d: number) => number>,\n    default(t: number, b: number, c: number, d: number) {\n      return (c * (-Math.pow(2, (-10 * t) / d) + 1) * 1024) / 1023 + b\n    }\n  }\n})\n\nconst emit = defineEmits(['mounted', 'callback'])\n\nconst formatNumber = (num: number | string) => {\n  const { decimals, decimal, separator, suffix, prefix } = props\n  num = Number(num).toFixed(decimals)\n  num += ''\n  const x = num.split('.')\n  let x1 = x[0]\n  const x2 = x.length > 1 ? decimal + x[1] : ''\n  const rgx = /(\\d+)(\\d{3})/\n  if (separator && !isNumber(separator)) {\n    while (rgx.test(x1)) {\n      x1 = x1.replace(rgx, '$1' + separator + '$2')\n    }\n  }\n  return prefix + x1 + x2 + suffix\n}\n\nconst state = reactive<{\n  localStartVal: number\n  printVal: number | null\n  displayValue: string\n  paused: boolean\n  localDuration: number | null\n  startTime: number | null\n  timestamp: number | null\n  rAF: any\n  remaining: number | null\n}>({\n  localStartVal: props.startVal,\n  displayValue: formatNumber(props.startVal),\n  printVal: null,\n  paused: false,\n  localDuration: props.duration,\n  startTime: null,\n  timestamp: null,\n  remaining: null,\n  rAF: null\n})\n\nconst displayValue = toRef(state, 'displayValue')\n\nonMounted(() => {\n  if (props.autoplay) {\n    start()\n  }\n  emit('mounted')\n})\n\nconst getCountDown = computed(() => {\n  return props.startVal > props.endVal\n})\n\nwatch([() => props.startVal, () => props.endVal], () => {\n  if (props.autoplay) {\n    start()\n  }\n})\n\nconst start = () => {\n  const { startVal, duration } = props\n  state.localStartVal = startVal\n  state.startTime = null\n  state.localDuration = duration\n  state.paused = false\n  state.rAF = requestAnimationFrame(count)\n}\n\nconst pauseResume = () => {\n  if (state.paused) {\n    resume()\n    state.paused = false\n  } else {\n    pause()\n    state.paused = true\n  }\n}\n\nconst pause = () => {\n  cancelAnimationFrame(state.rAF)\n}\n\nconst resume = () => {\n  state.startTime = null\n  state.localDuration = +(state.remaining as number)\n  state.localStartVal = +(state.printVal as number)\n  requestAnimationFrame(count)\n}\n\nconst reset = () => {\n  state.startTime = null\n  cancelAnimationFrame(state.rAF)\n  state.displayValue = formatNumber(props.startVal)\n}\n\nconst count = (timestamp: number) => {\n  const { useEasing, easingFn, endVal } = props\n  if (!state.startTime) state.startTime = timestamp\n  state.timestamp = timestamp\n  const progress = timestamp - state.startTime\n  state.remaining = (state.localDuration as number) - progress\n  if (useEasing) {\n    if (unref(getCountDown)) {\n      state.printVal =\n        state.localStartVal -\n        easingFn(progress, 0, state.localStartVal - endVal, state.localDuration as number)\n    } else {\n      state.printVal = easingFn(\n        progress,\n        state.localStartVal,\n        endVal - state.localStartVal,\n        state.localDuration as number\n      )\n    }\n  } else {\n    if (unref(getCountDown)) {\n      state.printVal =\n        state.localStartVal -\n        (state.localStartVal - endVal) * (progress / (state.localDuration as number))\n    } else {\n      state.printVal =\n        state.localStartVal +\n        (endVal - state.localStartVal) * (progress / (state.localDuration as number))\n    }\n  }\n  if (unref(getCountDown)) {\n    state.printVal = state.printVal < endVal ? endVal : state.printVal\n  } else {\n    state.printVal = state.printVal > endVal ? endVal : state.printVal\n  }\n  state.displayValue = formatNumber(state.printVal!)\n  if (progress < (state.localDuration as number)) {\n    state.rAF = requestAnimationFrame(count)\n  } else {\n    emit('callback')\n  }\n}\n\ndefineExpose({\n  pauseResume,\n  reset,\n  start,\n  pause\n})\n</script>\n\n<template>\n  <span :class=\"prefixCls\">\n    {{ displayValue }}\n  </span>\n</template>\n"],"names":["getPrefixCls","useDesign","prefixCls","props","__props","emit","__emit","formatNumber","num","decimals","decimal","separator","suffix","prefix","x","x1","x2","rgx","isNumber","state","reactive","displayValue","toRef","onMounted","start","getCountDown","computed","watch","startVal","duration","count","pauseResume","resume","pause","reset","timestamp","useEasing","easingFn","endVal","progress","unref","__expose"],"mappings":"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"}
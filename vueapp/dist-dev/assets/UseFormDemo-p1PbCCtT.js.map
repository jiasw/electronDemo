{"version":3,"file":"UseFormDemo-p1PbCCtT.js","sources":["../../src/views/Components/Form/UseFormDemo.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { Form, FormSchema } from '@/components/Form'\nimport { ContentWrap } from '@/components/ContentWrap'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { useForm } from '@/hooks/web/useForm'\nimport { reactive, unref, ref } from 'vue'\nimport { ElInput, FormItemProp, ComponentSize, ElMessage, ElMessageBox } from 'element-plus'\nimport { useValidator } from '@/hooks/web/useValidator'\nimport { getDictOneApi } from '@/api/common'\nimport { BaseButton } from '@/components/Button'\n\nconst { required } = useValidator()\n\nconst { t } = useI18n()\n\nconst treeSelectData = [\n  {\n    value: '1',\n    label: 'Level one 1',\n    children: [\n      {\n        value: '1-1',\n        label: 'Level two 1-1',\n        children: [\n          {\n            value: '1-1-1',\n            label: 'Level three 1-1-1'\n          }\n        ]\n      }\n    ]\n  },\n  {\n    value: '2',\n    label: 'Level one 2',\n    children: [\n      {\n        value: '2-1',\n        label: 'Level two 2-1',\n        children: [\n          {\n            value: '2-1-1',\n            label: 'Level three 2-1-1'\n          }\n        ]\n      },\n      {\n        value: '2-2',\n        label: 'Level two 2-2',\n        children: [\n          {\n            value: '2-2-1',\n            label: 'Level three 2-2-1'\n          }\n        ]\n      }\n    ]\n  },\n  {\n    value: '3',\n    label: 'Level one 3',\n    children: [\n      {\n        value: '3-1',\n        label: 'Level two 3-1',\n        children: [\n          {\n            value: '3-1-1',\n            label: 'Level three 3-1-1'\n          }\n        ]\n      },\n      {\n        value: '3-2',\n        label: 'Level two 3-2',\n        children: [\n          {\n            value: '3-2-1',\n            label: 'Level three 3-2-1'\n          }\n        ]\n      }\n    ]\n  }\n]\n\n// 模拟远程加载\nconst getTreeSelectData = () => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(treeSelectData)\n    }, 3000)\n  })\n}\n\nconst schema = reactive<FormSchema[]>([\n  {\n    field: 'field1',\n    label: t('formDemo.input'),\n    component: 'Input',\n    formItemProps: {\n      rules: [required()]\n    }\n  },\n  {\n    field: 'field2',\n    label: t('formDemo.select'),\n    component: 'Select',\n    componentProps: {\n      options: [\n        {\n          label: 'option1',\n          value: '1'\n        },\n        {\n          label: 'option2',\n          value: '2'\n        }\n      ]\n    },\n    formItemProps: {\n      rules: [required()]\n    }\n  },\n  {\n    field: 'field3',\n    label: t('formDemo.radio'),\n    component: 'RadioGroup',\n    hidden: true,\n    value: '1',\n    componentProps: {\n      options: [\n        {\n          label: 'option-1',\n          value: '1'\n        },\n        {\n          label: 'option-2',\n          value: '2'\n        }\n      ]\n    }\n  },\n  {\n    field: 'field4',\n    label: t('formDemo.checkbox'),\n    component: 'CheckboxGroup',\n    value: ['1'],\n    remove: true,\n    componentProps: {\n      options: [\n        {\n          label: 'option-1',\n          value: '1'\n        },\n        {\n          label: 'option-2',\n          value: '2'\n        },\n        {\n          label: 'option-3',\n          value: '3'\n        }\n      ]\n    }\n  },\n  {\n    field: 'field5',\n    component: 'DatePicker',\n    label: t('formDemo.datePicker'),\n    componentProps: {\n      type: 'date'\n    }\n  },\n  {\n    field: 'field6',\n    component: 'TimeSelect',\n    label: t('formDemo.timeSelect')\n  },\n  {\n    field: 'field7',\n    label: `${t('formDemo.treeSelect')}`,\n    component: 'TreeSelect',\n    // 远程加载option\n    optionApi: async () => {\n      const res = await getTreeSelectData()\n      return res\n    }\n  },\n  {\n    field: 'field8',\n    component: 'Upload',\n    label: `${t('formDemo.default')}`,\n    componentProps: {\n      limit: 3,\n      action: 'https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15',\n      // fileList: ,\n      multiple: true,\n      onPreview: (uploadFile) => {\n        console.log(uploadFile)\n      },\n      onRemove: (file) => {\n        console.log(file)\n      },\n      beforeRemove: (uploadFile) => {\n        return ElMessageBox.confirm(`Cancel the transfer of ${uploadFile.name} ?`).then(\n          () => true,\n          () => false\n        )\n      },\n      onExceed: (files, uploadFiles) => {\n        ElMessage.warning(\n          `The limit is 3, you selected ${files.length} files this time, add up to ${\n            files.length + uploadFiles.length\n          } totally`\n        )\n      },\n      slots: {\n        default: () => <BaseButton type=\"primary\">Click to upload</BaseButton>,\n        tip: () => <div class=\"el-upload__tip\">jpg/png files with a size less than 500KB.</div>\n      }\n    }\n  }\n])\n\nconst { formRegister, formMethods } = useForm()\nconst {\n  setProps,\n  delSchema,\n  addSchema,\n  setValues,\n  setSchema,\n  getComponentExpose,\n  getFormItemExpose,\n  getElFormExpose,\n  getFormData\n} = formMethods\n\nconst changeLabelWidth = (width: number | string) => {\n  setProps({\n    labelWidth: width\n  })\n}\n\nconst changeSize = (size: ComponentSize) => {\n  setProps({\n    size\n  })\n}\n\nconst changeDisabled = (bool: boolean) => {\n  setProps({\n    disabled: bool\n  })\n}\n\nconst changeSchema = (del: boolean) => {\n  if (del) {\n    delSchema('field2')\n  } else if (!del && schema[1].field !== 'field2') {\n    addSchema(\n      {\n        field: 'field2',\n        label: t('formDemo.select'),\n        component: 'Select',\n        componentProps: {\n          options: [\n            {\n              label: 'option1',\n              value: '1'\n            },\n            {\n              label: 'option2',\n              value: '2'\n            }\n          ]\n        }\n      },\n      1\n    )\n  }\n}\n\nconst setValue = async (reset: boolean) => {\n  const elFormExpose = await getElFormExpose()\n  if (reset) {\n    elFormExpose?.resetFields()\n  } else {\n    setValues({\n      field1: 'field1',\n      field2: '2',\n      field3: '2',\n      field4: ['1', '3'],\n      field5: '2022-01-27',\n      field6: '17:00',\n      field8: [\n        {\n          name: 'element-plus-logo.svg',\n          url: 'https://element-plus.org/images/element-plus-logo.svg'\n        },\n        {\n          name: 'element-plus-logo2.svg',\n          url: 'https://element-plus.org/images/element-plus-logo.svg'\n        }\n      ]\n    })\n    const formData = await getFormData()\n    console.log(formData)\n  }\n}\n\nconst index = ref(7)\n\nconst setLabel = () => {\n  setSchema([\n    {\n      field: 'field2',\n      path: 'label',\n      value: `${t('formDemo.select')} ${index.value}`\n    },\n    {\n      field: 'field2',\n      path: 'componentProps.options',\n      value: [\n        {\n          label: 'option-1',\n          value: '1'\n        },\n        {\n          label: 'option-2',\n          value: '2'\n        },\n        {\n          label: 'option-3',\n          value: '3'\n        }\n      ]\n    }\n  ])\n  index.value++\n}\n\nconst addItem = () => {\n  if (unref(index) % 2 === 0) {\n    addSchema({\n      field: `field${unref(index)}`,\n      label: `${t('formDemo.input')}${unref(index)}`,\n      component: 'Input'\n    })\n  } else {\n    addSchema(\n      {\n        field: `field${unref(index)}`,\n        label: `${t('formDemo.input')}${unref(index)}`,\n        component: 'Input'\n      },\n      unref(index)\n    )\n  }\n  index.value++\n}\n\nconst formValidation = async () => {\n  const elFormExpose = await getElFormExpose()\n  elFormExpose?.validate((isValid) => {\n    console.log(isValid)\n  })\n}\n\nconst verifyReset = async () => {\n  const elFormExpose = await getElFormExpose()\n  elFormExpose?.resetFields()\n}\n\nconst getDictOne = async () => {\n  const res = await getDictOneApi()\n  if (res) {\n    setSchema([\n      {\n        field: 'field2',\n        path: 'componentProps.options',\n        value: res.data\n      }\n    ])\n  }\n}\n\nconst inoutFocus = async () => {\n  const inputEl: ComponentRef<typeof ElInput> = await getComponentExpose('field1')\n  inputEl?.focus()\n}\n\nconst inoutValidation = async () => {\n  const formItem = await getFormItemExpose('field1')\n  const inputEl: ComponentRef<typeof ElInput> = await getComponentExpose('field1')\n  inputEl?.focus()\n  formItem?.validate('focus', (val: boolean) => {\n    console.log(val)\n  })\n}\n\nconst formValidate = (prop: FormItemProp, isValid: boolean, message: string) => {\n  console.log(prop, isValid, message)\n}\n\nsetTimeout(async () => {\n  const formData = await getFormData()\n  console.log(formData)\n}, 2000)\n\nconst getData = async () => {\n  const formData = await getFormData()\n  console.log(formData)\n}\n</script>\n\n<template>\n  <ContentWrap :title=\"`UseForm ${t('formDemo.operate')}`\" style=\"margin-bottom: 20px\">\n    <BaseButton @click=\"changeLabelWidth(150)\">{{ t('formDemo.change') }} labelWidth</BaseButton>\n    <BaseButton @click=\"changeLabelWidth('auto')\"\n      >{{ t('formDemo.restore') }} labelWidth</BaseButton\n    >\n\n    <BaseButton @click=\"changeSize('large')\">{{ t('formDemo.change') }} size</BaseButton>\n    <BaseButton @click=\"changeSize('default')\">{{ t('formDemo.restore') }} size</BaseButton>\n\n    <BaseButton @click=\"changeDisabled(true)\">{{ t('formDemo.disabled') }}</BaseButton>\n    <BaseButton @click=\"changeDisabled(false)\">{{ t('formDemo.disablement') }}</BaseButton>\n\n    <BaseButton @click=\"changeSchema(true)\">\n      {{ t('formDemo.delete') }} {{ t('formDemo.select') }}\n    </BaseButton>\n    <BaseButton @click=\"changeSchema(false)\">\n      {{ t('formDemo.add') }} {{ t('formDemo.select') }}\n    </BaseButton>\n\n    <BaseButton @click=\"setValue(false)\">{{ t('formDemo.setValue') }}</BaseButton>\n    <BaseButton @click=\"setValue(true)\">{{ t('formDemo.resetValue') }}</BaseButton>\n\n    <BaseButton @click=\"setLabel\">\n      {{ t('formDemo.set') }} {{ t('formDemo.select') }} label\n    </BaseButton>\n\n    <BaseButton @click=\"addItem\"> {{ t('formDemo.add') }} {{ t('formDemo.subitem') }} </BaseButton>\n\n    <BaseButton @click=\"formValidation\"> {{ t('formDemo.formValidation') }} </BaseButton>\n    <BaseButton @click=\"verifyReset\"> {{ t('formDemo.verifyReset') }} </BaseButton>\n\n    <BaseButton @click=\"getDictOne\">\n      {{ `${t('formDemo.select')} ${t('searchDemo.dynamicOptions')}` }}\n    </BaseButton>\n\n    <BaseButton @click=\"inoutFocus\">\n      {{ `${t('formDemo.input')} ${t('formDemo.focus')}` }}\n    </BaseButton>\n    <BaseButton @click=\"inoutValidation\">\n      {{ `${t('formDemo.input')} ${t('formDemo.formValidation')}` }}\n    </BaseButton>\n    <BaseButton @click=\"getData\"> 获取值 </BaseButton>\n  </ContentWrap>\n  <ContentWrap :title=\"`UseForm ${t('formDemo.example')}`\">\n    <Form :schema=\"schema\" @register=\"formRegister\" @validate=\"formValidate\" />\n  </ContentWrap>\n</template>\n\n<style lang=\"less\" scoped>\n.el-button {\n  margin-top: 10px;\n}\n</style>\n"],"names":["required","useValidator","t","useI18n","treeSelectData","value","label","children","getTreeSelectData","Promise","resolve","setTimeout","schema","reactive","field","component","formItemProps","rules","componentProps","options","hidden","remove","type","optionApi","__async","limit","action","multiple","onPreview","uploadFile","console","log","onRemove","file","beforeRemove","ElMessageBox","confirm","name","then","onExceed","files","uploadFiles","ElMessage","warning","length","slots","default","_createVNode2","BaseButton","_createTextVNode2","tip","formRegister","formMethods","useForm","setProps","delSchema","addSchema","setValues","setSchema","getComponentExpose","getFormItemExpose","getElFormExpose","getFormData","changeLabelWidth","width","labelWidth","changeSize","size","changeDisabled","bool","disabled","changeSchema","del","setValue","reset","elFormExpose","resetFields","field1","field2","field3","field4","field5","field6","field8","url","formData","index","ref","setLabel","path","addItem","unref","formValidation","validate","isValid","verifyReset","getDictOne","res","getDictOneApi","data","inoutFocus","inputEl","focus","inoutValidation","formItem","val","formValidate","prop","message","getData"],"mappings":"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"}
{"version":3,"file":"style.css_vue_type_style_index_0_src_true_lang-mhrgHJeF.js","sources":["../../src/components/Editor/src/Editor.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onBeforeUnmount, computed, PropType, unref, nextTick, ref, watch, shallowRef } from 'vue'\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue'\nimport { IDomEditor, IEditorConfig, i18nChangeLanguage } from '@wangeditor/editor'\nimport { propTypes } from '@/utils/propTypes'\nimport { isNumber } from '@/utils/is'\nimport { ElMessage } from 'element-plus'\nimport { useLocaleStore } from '@/store/modules/locale'\n\nconst localeStore = useLocaleStore()\n\nconst currentLocale = computed(() => localeStore.getCurrentLocale)\n\ni18nChangeLanguage(unref(currentLocale).lang)\n\nconst props = defineProps({\n  editorId: propTypes.string.def('wangeEditor-1'),\n  height: propTypes.oneOfType([Number, String]).def('500px'),\n  editorConfig: {\n    type: Object as PropType<IEditorConfig>,\n    default: () => undefined\n  },\n  modelValue: propTypes.string.def('')\n})\n\nconst emit = defineEmits(['change', 'update:modelValue'])\n\n// 编辑器实例，必须用 shallowRef\nconst editorRef = shallowRef<IDomEditor>()\n\nconst valueHtml = ref('')\n\nwatch(\n  () => props.modelValue,\n  (val: string) => {\n    if (val === unref(valueHtml)) return\n    valueHtml.value = val\n  }\n)\n\n// 监听\nwatch(\n  () => valueHtml.value,\n  (val: string) => {\n    emit('update:modelValue', val)\n  }\n)\n\nconst handleCreated = (editor: IDomEditor) => {\n  editorRef.value = editor\n  valueHtml.value = props.modelValue\n}\n\n// 编辑器配置\nconst editorConfig = computed((): IEditorConfig => {\n  return Object.assign(\n    {\n      readOnly: false,\n      customAlert: (s: string, t: string) => {\n        switch (t) {\n          case 'success':\n            ElMessage.success(s)\n            break\n          case 'info':\n            ElMessage.info(s)\n            break\n          case 'warning':\n            ElMessage.warning(s)\n            break\n          case 'error':\n            ElMessage.error(s)\n            break\n          default:\n            ElMessage.info(s)\n            break\n        }\n      },\n      autoFocus: false,\n      scroll: true,\n      uploadImgShowBase64: true\n    },\n    props.editorConfig || {}\n  )\n})\n\nconst editorStyle = computed(() => {\n  return {\n    height: isNumber(props.height) ? `${props.height}px` : props.height\n  }\n})\n\n// 回调函数\nconst handleChange = (editor: IDomEditor) => {\n  emit('change', editor)\n}\n\n// 组件销毁时，及时销毁编辑器\nonBeforeUnmount(() => {\n  const editor = unref(editorRef.value)\n\n  // 销毁，并移除 editor\n  editor?.destroy()\n})\n\nconst getEditorRef = async (): Promise<IDomEditor> => {\n  await nextTick()\n  return unref(editorRef.value) as IDomEditor\n}\n\ndefineExpose({\n  getEditorRef\n})\n</script>\n\n<template>\n  <div class=\"border-1 border-solid border-[var(--el-border-color)] z-10\">\n    <!-- 工具栏 -->\n    <Toolbar\n      :editor=\"editorRef\"\n      :editorId=\"editorId\"\n      class=\"border-0 b-b-1 border-solid border-[var(--el-border-color)]\"\n    />\n    <!-- 编辑器 -->\n    <Editor\n      v-model=\"valueHtml\"\n      :editorId=\"editorId\"\n      :defaultConfig=\"editorConfig\"\n      :style=\"editorStyle\"\n      @on-change=\"handleChange\"\n      @on-created=\"handleCreated\"\n    />\n  </div>\n</template>\n\n<style src=\"@wangeditor/editor/dist/css/style.css\"></style>\n"],"names":["localeStore","useLocaleStore","currentLocale","computed","i18nChangeLanguage","unref","props","__props","emit","__emit","editorRef","shallowRef","valueHtml","ref","watch","val","handleCreated","editor","editorConfig","s","t","ElMessage","editorStyle","isNumber","handleChange","onBeforeUnmount","__expose","__async","nextTick"],"mappings":"gzBASA,MAAMA,EAAcC,EAAe,EAE7BC,EAAgBC,EAAS,IAAMH,EAAY,gBAAgB,EAE9CI,EAAAC,EAAMH,CAAa,EAAE,IAAI,EAE5C,MAAMI,EAAQC,EAURC,EAAOC,EAGPC,EAAYC,EAAuB,EAEnCC,EAAYC,EAAI,EAAE,EAExBC,EACE,IAAMR,EAAM,WACXS,GAAgB,CACXA,IAAQV,EAAMO,CAAS,IAC3BA,EAAU,MAAQG,EAAA,CAEtB,EAGAD,EACE,IAAMF,EAAU,MACfG,GAAgB,CACfP,EAAK,oBAAqBO,CAAG,CAAA,CAEjC,EAEM,MAAAC,EAAiBC,GAAuB,CAC5CP,EAAU,MAAQO,EAClBL,EAAU,MAAQN,EAAM,UAC1B,EAGMY,EAAef,EAAS,IACrB,OAAO,OACZ,CACE,SAAU,GACV,YAAa,CAACgB,EAAWC,IAAc,CACrC,OAAQA,EAAG,CACT,IAAK,UACHC,EAAU,QAAQF,CAAC,EACnB,MACF,IAAK,OACHE,EAAU,KAAKF,CAAC,EAChB,MACF,IAAK,UACHE,EAAU,QAAQF,CAAC,EACnB,MACF,IAAK,QACHE,EAAU,MAAMF,CAAC,EACjB,MACF,QACEE,EAAU,KAAKF,CAAC,EAChB,KAAA,CAEN,EACA,UAAW,GACX,OAAQ,GACR,oBAAqB,EACvB,EACAb,EAAM,cAAgB,CAAA,CACxB,CACD,EAEKgB,EAAcnB,EAAS,KACpB,CACL,OAAQoB,EAASjB,EAAM,MAAM,EAAI,GAAGA,EAAM,MAAM,KAAOA,EAAM,MAC/D,EACD,EAGKkB,EAAgBP,GAAuB,CAC3CT,EAAK,SAAUS,CAAM,CACvB,EAGA,OAAAQ,EAAgB,IAAM,CACd,MAAAR,EAASZ,EAAMK,EAAU,KAAK,EAGpCO,GAAA,MAAAA,EAAQ,SAAQ,CACjB,EAOYS,EAAA,CACX,aANmB,IAAiCC,EAAA,sBACpD,aAAMC,EAAS,EACRvB,EAAMK,EAAU,KAAK,CAC9B,EAGE,CACD"}
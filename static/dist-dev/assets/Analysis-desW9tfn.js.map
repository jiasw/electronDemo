{"version":3,"file":"Analysis-desW9tfn.js","sources":["../../src/views/Dashboard/Analysis.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport PanelGroup from './components/PanelGroup.vue'\nimport { ElRow, ElCol, ElCard, ElSkeleton } from 'element-plus'\nimport { Echart } from '@/components/Echart'\nimport { pieOptions, barOptions, lineOptions } from './echarts-data'\nimport { ref, reactive, computed, watch, onMounted } from 'vue'\nimport {\n  getUserAccessSourceApi,\n  getWeeklyUserActivityApi,\n  getMonthlySalesApi\n} from '@/api/dashboard/analysis'\nimport { set } from 'lodash-es'\nimport { EChartsOption } from 'echarts'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { useAppStore } from '@/store/modules/app'\n\nconst { t } = useI18n()\n\nconst loading = ref(true)\n\nconst appStore = useAppStore()\nconst isDark = computed(() => appStore.getIsDark)\n\nconst pieOptionsData = reactive<EChartsOption>(pieOptions) as EChartsOption\n\n// 用户来源\nconst getUserAccessSource = async () => {\n  const res = await getUserAccessSourceApi().catch(() => {})\n  if (res) {\n    set(\n      pieOptionsData,\n      'legend.data',\n      res.data.map((v) => t(v.name))\n    )\n    pieOptionsData!.series![0].data = res.data.map((v) => {\n      return {\n        name: t(v.name),\n        value: v.value\n      }\n    })\n  }\n}\n\nconst barOptionsData = reactive<EChartsOption>(barOptions) as EChartsOption\n\n// 周活跃量\nconst getWeeklyUserActivity = async () => {\n  const res = await getWeeklyUserActivityApi().catch(() => {})\n  if (res) {\n    set(\n      barOptionsData,\n      'xAxis.data',\n      res.data.map((v) => t(v.name))\n    )\n    set(barOptionsData, 'series', [\n      {\n        name: t('analysis.activeQuantity'),\n        data: res.data.map((v) => v.value),\n        type: 'bar'\n      }\n    ])\n  }\n}\n\nconst lineOptionsData = reactive<EChartsOption>(lineOptions) as EChartsOption\n\n// 每月销售总额\nconst getMonthlySales = async () => {\n  const res = await getMonthlySalesApi().catch(() => {})\n  if (res) {\n    set(\n      lineOptionsData,\n      'xAxis.data',\n      res.data.map((v) => t(v.name))\n    )\n    set(lineOptionsData, 'series', [\n      {\n        name: t('analysis.estimate'),\n        smooth: true,\n        type: 'line',\n        data: res.data.map((v) => v.estimate),\n        animationDuration: 2800,\n        animationEasing: 'cubicInOut'\n      },\n      {\n        name: t('analysis.actual'),\n        smooth: true,\n        type: 'line',\n        itemStyle: {},\n        data: res.data.map((v) => v.actual),\n        animationDuration: 2800,\n        animationEasing: 'quadraticOut'\n      }\n    ])\n  }\n}\n\n/**\n * 更新 legend.textStyle\n */\nconst updateLegendTextStyle = (options) => {\n  const newTextStyle = {\n    color: isDark.value ? '#ccc' : '#333'\n  }\n  const inactiveColor = isDark.value ? '#abacac' : '#ccc'\n  set(options, 'title.textStyle', newTextStyle)\n  if (options !== barOptionsData) {\n    set(options, 'legend.textStyle', newTextStyle)\n    set(options, 'legend.inactiveColor', inactiveColor)\n  }\n  options === pieOptionsData && set(options, 'series[0].emptyCircleStyle.color', inactiveColor)\n}\n\nconst getAllApi = async () => {\n  await Promise.all([getUserAccessSource(), getWeeklyUserActivity(), getMonthlySales()])\n  loading.value = false\n}\n\ngetAllApi()\n\n// 监听暗黑模式变化并重新更新样式\nwatch(isDark, () => {\n  updateLegendTextStyle(pieOptionsData)\n  updateLegendTextStyle(barOptionsData)\n  updateLegendTextStyle(lineOptionsData)\n})\nonMounted(() => {\n  updateLegendTextStyle(pieOptionsData)\n  updateLegendTextStyle(barOptionsData)\n  updateLegendTextStyle(lineOptionsData)\n})\n</script>\n\n<template>\n  <PanelGroup />\n  <ElRow :gutter=\"20\" justify=\"space-between\">\n    <ElCol :xl=\"10\" :lg=\"10\" :md=\"24\" :sm=\"24\" :xs=\"24\">\n      <ElCard shadow=\"hover\" class=\"mb-20px\">\n        <ElSkeleton :loading=\"loading\" animated>\n          <Echart :options=\"pieOptionsData\" :height=\"300\" />\n        </ElSkeleton>\n      </ElCard>\n    </ElCol>\n    <ElCol :xl=\"14\" :lg=\"14\" :md=\"24\" :sm=\"24\" :xs=\"24\">\n      <ElCard shadow=\"hover\" class=\"mb-20px\">\n        <ElSkeleton :loading=\"loading\" animated>\n          <Echart :options=\"barOptionsData\" :height=\"300\" />\n        </ElSkeleton>\n      </ElCard>\n    </ElCol>\n    <ElCol :span=\"24\">\n      <ElCard shadow=\"hover\" class=\"mb-20px\">\n        <ElSkeleton :loading=\"loading\" animated :rows=\"4\">\n          <Echart :options=\"lineOptionsData\" :height=\"350\" />\n        </ElSkeleton>\n      </ElCard>\n    </ElCol>\n  </ElRow>\n</template>\n"],"names":["t","useI18n","loading","ref","appStore","useAppStore","isDark","computed","pieOptionsData","reactive","pieOptions","getUserAccessSource","__async","res","getUserAccessSourceApi","set","v","barOptionsData","barOptions","getWeeklyUserActivity","getWeeklyUserActivityApi","lineOptionsData","lineOptions","getMonthlySales","getMonthlySalesApi","updateLegendTextStyle","options","newTextStyle","inactiveColor","watch","onMounted"],"mappings":"y0BAgBM,KAAA,CAAE,EAAAA,CAAE,EAAIC,EAAQ,EAEhBC,EAAUC,EAAI,EAAI,EAElBC,EAAWC,EAAY,EACvBC,EAASC,EAAS,IAAMH,EAAS,SAAS,EAE1CI,EAAiBC,EAAwBC,CAAU,EAGnDC,EAAsB,IAAYC,EAAA,sBACtC,MAAMC,EAAM,MAAMC,EAAuB,EAAE,MAAM,IAAM,CAAA,CAAE,EACrDD,IACFE,EACEP,EACA,cACAK,EAAI,KAAK,IAAKG,GAAMhB,EAAEgB,EAAE,IAAI,CAAC,CAC/B,EACgBR,EAAA,OAAQ,CAAC,EAAE,KAAOK,EAAI,KAAK,IAAKG,IACvC,CACL,KAAMhB,EAAEgB,EAAE,IAAI,EACd,MAAOA,EAAE,KACX,EACD,EAEL,GAEMC,EAAiBR,EAAwBS,CAAU,EAGnDC,EAAwB,IAAYP,EAAA,sBACxC,MAAMC,EAAM,MAAMO,EAAyB,EAAE,MAAM,IAAM,CAAA,CAAE,EACvDP,IACFE,EACEE,EACA,aACAJ,EAAI,KAAK,IAAKG,GAAMhB,EAAEgB,EAAE,IAAI,CAAC,CAC/B,EACAD,EAAIE,EAAgB,SAAU,CAC5B,CACE,KAAMjB,EAAE,yBAAyB,EACjC,KAAMa,EAAI,KAAK,IAAKG,GAAMA,EAAE,KAAK,EACjC,KAAM,KAAA,CACR,CACD,EAEL,GAEMK,EAAkBZ,EAAwBa,CAAW,EAGrDC,EAAkB,IAAYX,EAAA,sBAClC,MAAMC,EAAM,MAAMW,EAAmB,EAAE,MAAM,IAAM,CAAA,CAAE,EACjDX,IACFE,EACEM,EACA,aACAR,EAAI,KAAK,IAAKG,GAAMhB,EAAEgB,EAAE,IAAI,CAAC,CAC/B,EACAD,EAAIM,EAAiB,SAAU,CAC7B,CACE,KAAMrB,EAAE,mBAAmB,EAC3B,OAAQ,GACR,KAAM,OACN,KAAMa,EAAI,KAAK,IAAKG,GAAMA,EAAE,QAAQ,EACpC,kBAAmB,KACnB,gBAAiB,YACnB,EACA,CACE,KAAMhB,EAAE,iBAAiB,EACzB,OAAQ,GACR,KAAM,OACN,UAAW,CAAC,EACZ,KAAMa,EAAI,KAAK,IAAKG,GAAMA,EAAE,MAAM,EAClC,kBAAmB,KACnB,gBAAiB,cAAA,CACnB,CACD,EAEL,GAKMS,EAAyBC,GAAY,CACzC,MAAMC,EAAe,CACnB,MAAOrB,EAAO,MAAQ,OAAS,MACjC,EACMsB,EAAgBtB,EAAO,MAAQ,UAAY,OAC7CS,EAAAW,EAAS,kBAAmBC,CAAY,EACxCD,IAAYT,IACVF,EAAAW,EAAS,mBAAoBC,CAAY,EACzCZ,EAAAW,EAAS,uBAAwBE,CAAa,GAEpDF,IAAYlB,GAAkBO,EAAIW,EAAS,mCAAoCE,CAAa,CAC9F,EAOU,OALoBhB,EAAA,sBACtB,MAAA,QAAQ,IAAI,CAACD,IAAuBQ,EAAsB,EAAGI,EAAgB,CAAC,CAAC,EACrFrB,EAAQ,MAAQ,EAClB,GAKA2B,EAAMvB,EAAQ,IAAM,CAClBmB,EAAsBjB,CAAc,EACpCiB,EAAsBR,CAAc,EACpCQ,EAAsBJ,CAAe,CAAA,CACtC,EACDS,EAAU,IAAM,CACdL,EAAsBjB,CAAc,EACpCiB,EAAsBR,CAAc,EACpCQ,EAAsBJ,CAAe,CAAA,CACtC"}
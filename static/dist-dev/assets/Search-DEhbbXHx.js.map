{"version":3,"file":"Search-DEhbbXHx.js","sources":["../../src/hooks/web/useSearch.ts","../../src/views/Components/Search.vue"],"sourcesContent":["import { ref, unref, nextTick } from 'vue'\nimport { FormSchema, FormSetProps } from '@/components/Form'\nimport { SearchExpose, SearchProps } from '@/components/Search'\n\nexport const useSearch = () => {\n  // Search实例\n  const searchRef = ref<SearchExpose>()\n\n  /**\n   * @param ref Search实例\n   * @param elRef ElForm实例\n   */\n  const register = (ref: SearchExpose) => {\n    searchRef.value = ref\n  }\n\n  const getSearch = async () => {\n    await nextTick()\n    const search = unref(searchRef)\n    if (!search) {\n      console.error('The Search is not registered. Please use the register method to register')\n    }\n    return search\n  }\n\n  // 一些内置的方法\n  const methods = {\n    /**\n     * @description 设置search组件的props\n     * @param field FormItem的field\n     */\n    setProps: async (props: SearchProps = {}) => {\n      const search = await getSearch()\n      search?.setProps(props)\n      if (props.model) {\n        search?.setValues(props.model)\n      }\n    },\n\n    /**\n     * @description 设置form的值\n     * @param data 需要设置的数据\n     */\n    setValues: async (data: Recordable) => {\n      const search = await getSearch()\n      search?.setValues(data)\n    },\n\n    /**\n     * @description 设置schema\n     * @param schemaProps 需要设置的schemaProps\n     */\n    setSchema: async (schemaProps: FormSetProps[]) => {\n      const search = await getSearch()\n      search?.setSchema(schemaProps)\n    },\n\n    /**\n     * @description 新增schema\n     * @param formSchema 需要新增数据\n     * @param index 在哪里新增\n     */\n    addSchema: async (formSchema: FormSchema, index?: number) => {\n      const search = await getSearch()\n      search?.addSchema(formSchema, index)\n    },\n\n    /**\n     * @description 删除schema\n     * @param field 删除哪个数据\n     */\n    delSchema: async (field: string) => {\n      const search = await getSearch()\n      search?.delSchema(field)\n    },\n\n    /**\n     * @description 获取表单数据\n     * @returns form data\n     */\n    getFormData: async <T = Recordable>(): Promise<T> => {\n      const search = await getSearch()\n      return search?.getFormData() as T\n    }\n  }\n\n  return {\n    searchRegister: register,\n    searchMethods: methods\n  }\n}\n","<script setup lang=\"ts\">\nimport { ContentWrap } from '@/components/ContentWrap'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { Search } from '@/components/Search'\nimport { reactive, ref, unref } from 'vue'\nimport { getDictOneApi } from '@/api/common'\nimport { FormSchema } from '@/components/Form'\nimport { useSearch } from '@/hooks/web/useSearch'\n\nconst { t } = useI18n()\n\nconst { searchRegister, searchMethods } = useSearch()\nconst { setSchema, setProps, setValues, getFormData } = searchMethods\n\nconst treeSelectData = [\n  {\n    value: '1',\n    label: 'Level one 1',\n    children: [\n      {\n        value: '1-1',\n        label: 'Level two 1-1',\n        children: [\n          {\n            value: '1-1-1',\n            label: 'Level three 1-1-1'\n          }\n        ]\n      }\n    ]\n  },\n  {\n    value: '2',\n    label: 'Level one 2',\n    children: [\n      {\n        value: '2-1',\n        label: 'Level two 2-1',\n        children: [\n          {\n            value: '2-1-1',\n            label: 'Level three 2-1-1'\n          }\n        ]\n      },\n      {\n        value: '2-2',\n        label: 'Level two 2-2',\n        children: [\n          {\n            value: '2-2-1',\n            label: 'Level three 2-2-1'\n          }\n        ]\n      }\n    ]\n  },\n  {\n    value: '3',\n    label: 'Level one 3',\n    children: [\n      {\n        value: '3-1',\n        label: 'Level two 3-1',\n        children: [\n          {\n            value: '3-1-1',\n            label: 'Level three 3-1-1'\n          }\n        ]\n      },\n      {\n        value: '3-2',\n        label: 'Level two 3-2',\n        children: [\n          {\n            value: '3-2-1',\n            label: 'Level three 3-2-1'\n          }\n        ]\n      }\n    ]\n  }\n]\n\n// 模拟远程加载\nconst getTreeSelectData = () => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(treeSelectData)\n    }, 3000)\n  })\n}\n\nconst schema = reactive<FormSchema[]>([\n  {\n    field: 'field1',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field2',\n    label: t('formDemo.select'),\n    component: 'Select',\n    componentProps: {\n      options: [\n        {\n          label: 'option1',\n          value: '1'\n        },\n        {\n          label: 'option2',\n          value: '2'\n        }\n      ],\n      on: {\n        change: (value: string) => {\n          console.log(value)\n        }\n      }\n    }\n  },\n  {\n    field: 'field3',\n    label: t('formDemo.radio'),\n    component: 'RadioGroup',\n    componentProps: {\n      options: [\n        {\n          label: 'option-1',\n          value: '1'\n        },\n        {\n          label: 'option-2',\n          value: '2'\n        }\n      ]\n    }\n  },\n  {\n    field: 'field5',\n    component: 'DatePicker',\n    label: t('formDemo.datePicker'),\n    componentProps: {\n      type: 'date'\n    }\n  },\n  {\n    field: 'field6',\n    component: 'TimeSelect',\n    label: t('formDemo.timeSelect')\n  },\n  {\n    field: 'field8',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field9',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field10',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field11',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field12',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field13',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field14',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field15',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field16',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field17',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field18',\n    label: t('formDemo.input'),\n    component: 'Input'\n  },\n  {\n    field: 'field19',\n    label: `${t('formDemo.treeSelect')}`,\n    component: 'TreeSelect',\n    // 远程加载option\n    optionApi: async () => {\n      const res = await getTreeSelectData()\n      return res\n    }\n  }\n])\n\nconst isGrid = ref(false)\n\nconst changeGrid = (grid: boolean) => {\n  setProps({\n    isCol: grid\n  })\n  // isGrid.value = grid\n}\n\nconst layout = ref('inline')\n\nconst changeLayout = () => {\n  layout.value = unref(layout) === 'inline' ? 'bottom' : 'inline'\n}\n\nconst buttonPosition = ref('left')\n\nconst changePosition = (position: string) => {\n  layout.value = 'bottom'\n  buttonPosition.value = position\n}\n\nconst getDictOne = async () => {\n  const res = await getDictOneApi()\n  if (res) {\n    setSchema([\n      {\n        field: 'field2',\n        path: 'componentProps.options',\n        value: res.data\n      }\n    ])\n  }\n}\n\nconst handleSearch = async (data: any) => {\n  const formData = await getFormData()\n  console.log(formData)\n  console.log(data)\n}\n\nconst delRadio = () => {\n  setSchema([\n    {\n      field: 'field3',\n      path: 'remove',\n      value: true\n    }\n  ])\n}\n\nconst restoreRadio = () => {\n  setSchema([\n    {\n      field: 'field3',\n      path: 'remove',\n      value: false\n    }\n  ])\n}\n\nconst setValue = () => {\n  setValues({\n    field1: 'Joy'\n  })\n}\n\nconst searchLoading = ref(false)\nconst changeSearchLoading = () => {\n  searchLoading.value = true\n  setTimeout(() => {\n    searchLoading.value = false\n  }, 2000)\n}\n\nconst resetLoading = ref(false)\nconst changeResetLoading = () => {\n  resetLoading.value = true\n  setTimeout(() => {\n    resetLoading.value = false\n  }, 2000)\n}\n</script>\n\n<template>\n  <ContentWrap\n    :title=\"`${t('searchDemo.search')} ${t('searchDemo.operate')}`\"\n    style=\"margin-bottom: 20px\"\n  >\n    <BaseButton @click=\"changeGrid(true)\">{{ t('searchDemo.grid') }}</BaseButton>\n    <BaseButton @click=\"changeGrid(false)\">\n      {{ t('searchDemo.restore') }} {{ t('searchDemo.grid') }}\n    </BaseButton>\n\n    <BaseButton @click=\"changeLayout\">\n      {{ t('searchDemo.button') }} {{ t('searchDemo.position') }}\n    </BaseButton>\n\n    <BaseButton @click=\"changePosition('left')\">\n      {{ t('searchDemo.bottom') }} {{ t('searchDemo.position') }}-{{ t('searchDemo.left') }}\n    </BaseButton>\n    <BaseButton @click=\"changePosition('center')\">\n      {{ t('searchDemo.bottom') }} {{ t('searchDemo.position') }}-{{ t('searchDemo.center') }}\n    </BaseButton>\n    <BaseButton @click=\"changePosition('right')\">\n      {{ t('searchDemo.bottom') }} {{ t('searchDemo.position') }}-{{ t('searchDemo.right') }}\n    </BaseButton>\n    <BaseButton @click=\"getDictOne\">\n      {{ t('formDemo.select') }} {{ t('searchDemo.dynamicOptions') }}\n    </BaseButton>\n    <BaseButton @click=\"delRadio\">{{ t('searchDemo.deleteRadio') }}</BaseButton>\n    <BaseButton @click=\"restoreRadio\">{{ t('searchDemo.restoreRadio') }}</BaseButton>\n    <BaseButton @click=\"setValue\">{{ t('formDemo.setValue') }}</BaseButton>\n\n    <BaseButton @click=\"changeSearchLoading\">\n      {{ t('searchDemo.search') }} {{ t('searchDemo.loading') }}\n    </BaseButton>\n    <BaseButton @click=\"changeResetLoading\">\n      {{ t('searchDemo.reset') }} {{ t('searchDemo.loading') }}\n    </BaseButton>\n  </ContentWrap>\n\n  <ContentWrap :title=\"t('searchDemo.search')\" :message=\"t('searchDemo.searchDes')\">\n    <Search\n      :schema=\"schema\"\n      :is-col=\"isGrid\"\n      :layout=\"layout\"\n      :button-position=\"buttonPosition\"\n      :search-loading=\"searchLoading\"\n      :reset-loading=\"resetLoading\"\n      show-expand\n      expand-field=\"field6\"\n      @search=\"handleSearch\"\n      @reset=\"handleSearch\"\n      @register=\"searchRegister\"\n    />\n  </ContentWrap>\n</template>\n\n<style lang=\"less\" scoped>\n.el-button {\n  margin-top: 10px;\n}\n</style>\n"],"names":["useSearch","searchRef","ref","register","getSearch","__async","nextTick","search","unref","_0","props","data","schemaProps","formSchema","index","field","t","useI18n","searchRegister","searchMethods","setSchema","setProps","setValues","getFormData","treeSelectData","getTreeSelectData","resolve","schema","reactive","value","isGrid","changeGrid","grid","layout","changeLayout","buttonPosition","changePosition","position","getDictOne","res","getDictOneApi","handleSearch","formData","delRadio","restoreRadio","setValue","searchLoading","changeSearchLoading","resetLoading","changeResetLoading"],"mappings":"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"}
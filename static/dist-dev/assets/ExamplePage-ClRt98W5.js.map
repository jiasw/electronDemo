{"version":3,"file":"ExamplePage-ClRt98W5.js","sources":["../../src/views/Example/Page/ExamplePage.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { ContentWrap } from '@/components/ContentWrap'\nimport { Search } from '@/components/Search'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { ElTag } from 'element-plus'\nimport { Table } from '@/components/Table'\nimport { getTableListApi, delTableListApi } from '@/api/table'\nimport { useTable } from '@/hooks/web/useTable'\nimport { TableData } from '@/api/table/types'\nimport { reactive, ref, unref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useEventBus } from '@/hooks/event/useEventBus'\nimport { CrudSchema, useCrudSchemas } from '@/hooks/web/useCrudSchemas'\nimport { BaseButton } from '@/components/Button'\n\ndefineOptions({\n  name: 'ExamplePage'\n})\n\nconst { push } = useRouter()\n\nconst ids = ref<string[]>([])\n\nconst searchParams = ref({})\nconst setSearchParams = (params: any) => {\n  searchParams.value = params\n  getList()\n}\n\nconst { tableRegister, tableState, tableMethods } = useTable({\n  fetchDataApi: async () => {\n    const { currentPage, pageSize } = tableState\n    const res = await getTableListApi({\n      pageIndex: unref(currentPage),\n      pageSize: unref(pageSize),\n      ...unref(searchParams)\n    })\n    return {\n      list: res.data.list,\n      total: res.data.total\n    }\n  },\n  fetchDelApi: async () => {\n    const res = await delTableListApi(unref(ids))\n    return !!res\n  }\n})\nconst { loading, dataList, total, currentPage, pageSize } = tableState\nconst { getList, getElTableExpose, delList } = tableMethods\n\ngetList()\n\nuseEventBus({\n  name: 'getList',\n  callback: (type: string) => {\n    if (type === 'add') {\n      currentPage.value = 1\n    }\n    getList()\n  }\n})\n\nconst { t } = useI18n()\n\nconst crudSchemas = reactive<CrudSchema[]>([\n  {\n    field: 'selection',\n    search: {\n      hidden: true\n    },\n    form: {\n      hidden: true\n    },\n    detail: {\n      hidden: true\n    },\n    table: {\n      type: 'selection'\n    }\n  },\n  {\n    field: 'index',\n    label: t('tableDemo.index'),\n    type: 'index',\n    search: {\n      hidden: true\n    },\n    form: {\n      hidden: true\n    },\n    detail: {\n      hidden: true\n    }\n  },\n  {\n    field: 'title',\n    label: t('tableDemo.title'),\n    search: {\n      component: 'Input'\n    },\n    form: {\n      component: 'Input',\n      colProps: {\n        span: 24\n      }\n    },\n    detail: {\n      span: 24\n    }\n  },\n  {\n    field: 'author',\n    label: t('tableDemo.author'),\n    search: {\n      hidden: true\n    }\n  },\n  {\n    field: 'display_time',\n    label: t('tableDemo.displayTime'),\n    search: {\n      hidden: true\n    },\n    form: {\n      component: 'DatePicker',\n      componentProps: {\n        type: 'datetime',\n        valueFormat: 'YYYY-MM-DD HH:mm:ss'\n      }\n    }\n  },\n  {\n    field: 'importance',\n    label: t('tableDemo.importance'),\n    search: {\n      hidden: true\n    },\n    form: {\n      component: 'Select',\n      componentProps: {\n        style: {\n          width: '100%'\n        },\n        options: [\n          {\n            label: '重要',\n            value: 3\n          },\n          {\n            label: '良好',\n            value: 2\n          },\n          {\n            label: '一般',\n            value: 1\n          }\n        ]\n      }\n    },\n    detail: {\n      slots: {\n        default: (data: any) => {\n          return (\n            <ElTag\n              type={\n                data.importance === 1 ? 'success' : data.importance === 2 ? 'warning' : 'danger'\n              }\n            >\n              {data.importance === 1\n                ? t('tableDemo.important')\n                : data.importance === 2\n                  ? t('tableDemo.good')\n                  : t('tableDemo.commonly')}\n            </ElTag>\n          )\n        }\n      }\n    }\n  },\n  {\n    field: 'pageviews',\n    label: t('tableDemo.pageviews'),\n    search: {\n      hidden: true\n    },\n    form: {\n      component: 'InputNumber',\n      value: 0\n    }\n  },\n  {\n    field: 'content',\n    label: t('exampleDemo.content'),\n    search: {\n      hidden: true\n    },\n    table: {\n      show: false\n    },\n    form: {\n      component: 'Editor',\n      colProps: {\n        span: 24\n      }\n    },\n    detail: {\n      span: 24,\n      slots: {\n        default: (data: any) => {\n          return <div innerHTML={data.content}></div>\n        }\n      }\n    }\n  },\n  {\n    field: 'action',\n    width: '260px',\n    label: t('tableDemo.action'),\n    search: {\n      hidden: true\n    },\n    form: {\n      hidden: true\n    },\n    detail: {\n      hidden: true\n    },\n    table: {\n      slots: {\n        default: (data: any) => {\n          return (\n            <>\n              <BaseButton type=\"primary\" onClick={() => action(data.row, 'edit')}>\n                {t('exampleDemo.edit')}\n              </BaseButton>\n              <BaseButton type=\"success\" onClick={() => action(data.row, 'detail')}>\n                {t('exampleDemo.detail')}\n              </BaseButton>\n              <BaseButton type=\"danger\" onClick={() => delData(data.row)}>\n                {t('exampleDemo.del')}\n              </BaseButton>\n            </>\n          )\n        }\n      }\n    }\n  }\n])\n\n// @ts-ignore\nconst { allSchemas } = useCrudSchemas(crudSchemas)\n\nconst AddAction = () => {\n  push('/example/example-add')\n}\n\nconst delLoading = ref(false)\n\nconst delData = async (row: TableData | null) => {\n  const elTableExpose = await getElTableExpose()\n  ids.value = row ? [row.id] : elTableExpose?.getSelectionRows().map((v: TableData) => v.id) || []\n  delLoading.value = true\n  await delList(unref(ids).length).finally(() => {\n    delLoading.value = false\n  })\n}\n\nconst action = (row: TableData, type: string) => {\n  push(`/example/example-${type}?id=${row.id}`)\n}\n</script>\n\n<template>\n  <ContentWrap>\n    <Search :schema=\"allSchemas.searchSchema\" @search=\"setSearchParams\" @reset=\"setSearchParams\" />\n\n    <div class=\"mb-10px\">\n      <BaseButton type=\"primary\" @click=\"AddAction\">{{ t('exampleDemo.add') }}</BaseButton>\n      <BaseButton :loading=\"delLoading\" type=\"danger\" @click=\"delData(null)\">\n        {{ t('exampleDemo.del') }}\n      </BaseButton>\n    </div>\n\n    <Table\n      v-model:pageSize=\"pageSize\"\n      v-model:currentPage=\"currentPage\"\n      :columns=\"allSchemas.tableColumns\"\n      :data=\"dataList\"\n      :loading=\"loading\"\n      :pagination=\"{\n        total: total\n      }\"\n      @register=\"tableRegister\"\n    />\n  </ContentWrap>\n</template>\n@/hooks/event/useEventBus\n"],"names":["_isSlot","s","Object","prototype","toString","call","_isVNode","push","useRouter","ids","ref","searchParams","setSearchParams","params","value","getList","tableRegister","tableState","tableMethods","useTable","fetchDataApi","__async","currentPage","pageSize","res","getTableListApi","__spreadValues","pageIndex","unref","list","data","total","fetchDelApi","delTableListApi","loading","dataList","getElTableExpose","delList","useEventBus","name","callback","type","t","useI18n","crudSchemas","reactive","field","search","hidden","form","detail","table","label","component","colProps","span","componentProps","valueFormat","style","width","options","slots","default","_createVNode2","ElTag","importance","show","content","_slot","_slot2","_slot3","_Fragment","BaseButton","onClick","action","row","delData","allSchemas","useCrudSchemas","AddAction","delLoading","elTableExpose","id","getSelectionRows","map","v","length","finally"],"mappings":"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"}